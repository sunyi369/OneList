<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OneList</title>
    <style>
        @font-face{
            font-family: 'icomoon';
            src : url("data:application/x-font-woff;charset=utf-8;base64,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") format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: block;
        }
        [class^="icon-"], [class*=" icon-"] {
            font-family: 'icomoon' !important;
            speak: none;
            font-style: normal;
            font-weight: normal;
            font-variant: normal;
            text-transform: none;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .icon-home:before {
            content: "\e900";
        }
        .icon-folder-open:before {
            content: "\e930";
        }
        .icon-file-text2:before {
            content: "\e926";
        }
        .icon-arrow-left2:before {
            content: "\ea40";
        }
        body {
            background-color: rgb(247, 247, 249);
        }
        h1 {
            text-align: center;
            color: rgb(51, 51, 51);
            font-size: 28px;
            letter-spacing: 2px;
            line-height: 64px;
        }
        a {
            text-decoration: none;
            color: black;
        }
        a:hover {
            text-decoration: underline;
        }
        th {
            font-weight: normal;
        }
        .list-wrapper {
            width: 80%;
            margin: 0 auto;
            margin-bottom: 40px;
            position: relative;
            box-shadow: 0 0 32px 0 rgba(0, 0, 0, 0.1);
        }
        .list-header-container {
            margin: 0;
            border: 0 none;
            padding: 15px 50px;
            text-align: left;
            font-weight: 400;
            color: #000000;
            background-color: #f7f7f9;
        }
        .list-title th {
            font-weight: bold;
        }
        .list-body-container {
            position: relative;
            left: 0;
            overflow-x: hidden;
            overflow-y: auto;
            box-sizing: border-box;
            background: white;
        }
        .list-table {
            width: 100%;
            padding: 20px;
            border-spacing: 0;
        }
        .list-table tr th{
            text-align: right;
        }
        .list-table tr th:first-child {
            text-align: left;
            padding: 5px 0;
        }
        .item:hover {
            font-weight: 200;
            background-color: gainsboro;
        }
        #back{
            position: absolute;
            top: 35px;
            right: 35px;
        }
    </style>
</head>
<body>
    <h1>
      <span onclick="Goto(RootPath);">OneList</span>
    </h1>
    <div class="list-wrapper">
      <div class="list-container">
        <div class="list-header-container">
            <h3>OneList Local Path</h3>
            <span id="back" class="icon-arrow-left2" onclick="Goto(Back());"></span>
        </div>
        <div class="list-body-container">
          <table class="list-table">
              <tr class="list-title">
                <th onclick="View('name');">文件</th>
                <th onclick="View('date');">修改时间</th>
                <th>大小</th>
              </tr>
          </table>
        </div>
      </div>
    </div>
</body>
<script>
    var RootPath = "{{ escape(rootPath) }}";
    var CurrentPath = "{{ escape(currentPath) }}";
    var RawData = "{{ escape(items) }}";
    if (CurrentPath === "/"){ CurrentPath = "" }
    var Reverse = false;
    var PageData = JSON.parse(window.atob(RawData));
    var ArrayPath = new Array();
    var ArrayFloder = new Array();
    var ArrayFile = new Array();
    for(var item in PageData){
        if (item.indexOf("@") == 0) { continue }
        if (PageData[item]['@type'] == 'file') {
            ArrayFile.push(PageData[item]);
        } else if (PageData[item]['@type'] == 'folder') {
            ArrayFloder.push(PageData[item]);
        }
    }
    function Goto(thePath) {window.location.href = thePath;}
    function compare(property) {
        return function(a,b){
            var value0 = a[property].toLowerCase();
            var value1 = b[property].toLowerCase();
            return value0.localeCompare(value1);
        }
    }
    function Clear() {
        var ClassList = new Array("item");
        for(var item in ClassList){
            var Elem = document.getElementsByClassName(ClassList[item]);
            for(var i = Elem.length-1; i >= 0 ; i--) {
                Elem[i].parentNode.removeChild(Elem[i]);
            }
        }
        var ElemH3 = document.getElementsByTagName("h3")[0];
        var newH3 = document.createElement("h3");
        var localPath = CurrentPath.trim().replace(/^\//, "").replace(/\/$/, "");
        var localHtmlArray = new Array();
        localHtmlArray.push("<a href='//" + window.location.host + RootPath + "'>" + '<span class="icon-home"></span>' + "</a>");
        if (localPath !== "" ){
            var localPathArray = localPath.split("/");
            var localHref = "";
            for(var j=0; j<localPathArray.length; j++){
                localHref += "/" + localPathArray[j];
                if (j === 0 && RootPath !== "/"){ continue }
                localHtmlArray.push("<a href='//" + window.location.host + localHref + "'>" + localPathArray[j] + "</a>");
            }
        }
        newH3.innerHTML = localHtmlArray.join(" / ");
        ElemH3.replaceWith(newH3);
        ArrayPath = localHtmlArray;
    }
    function Back() {
        var Num = ArrayPath.length - 1;
        var ElemNum = 0;
        var ElemBack = document.createElement("div");
        if (Num > 0){ElemNum = Num - 1;}
        ElemBack.innerHTML = ArrayPath[ElemNum];
        return ElemBack.childNodes[0].href
    }
    function View(Property) {
        console.log("sort:", Property, "reverse:", Reverse);
        ArrayFloder.sort(compare(Property));
        ArrayFile.sort(compare(Property));
        if (Reverse) {
            ArrayFloder.reverse();
            ArrayFile.reverse();
        }
        Reverse = !(Reverse);
        Clear();
        var Elem = document.getElementsByClassName("list-table")[0];
        var ArrayItem = ArrayFloder.concat(ArrayFile);
        for(var item in ArrayItem){
            var newChild = document.createElement("tr");
            var iconHtml = "";
            if (ArrayItem[item]['@type'] == 'folder') {
                iconHtml = '<span class="icon-folder-open"> </span>';
            } else if (ArrayItem[item]['@type'] == 'file') {
                iconHtml = '<span class="icon-file-text2"> </span>';
            } else { continue }
            newChild.setAttribute('class', 'item');
            newChild.innerHTML = "<th class=\"list-data\">" + iconHtml + "<a href='//" + window.location.host + CurrentPath + "/" + ArrayItem[item]['name'] +"'>" + ArrayItem[item]['name'] + "</a></th><th class=\"list-data\">" + ArrayItem[item]['date'] + "</th><th class=\"list-data\">" + ArrayItem[item]['size'] + "</th>";
            Elem.lastChild.appendChild(newChild);
        }
    }
    window.onload = View("name");
</script>
</html>
